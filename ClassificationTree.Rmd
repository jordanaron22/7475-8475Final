---
title: "Classification Tree"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Loading in data and splitting into test and train
```{r}
library(tidyverse)
library(rpart)
library(randomForest)
library(tree)
set.seed(1)

tree_data <- processed_data[,c(28,65,86,88,180:191,196:203)]

train_ind <- sample(30491, 24393)
tree_train <- tree_data[train_ind,]
tree_test <- tree_data[-train_ind,]
```

Full tree, no pruning
```{r}
full_tree <- rpart(as.factor(Label) ~ ., data = tree_train)

printcp(full_tree)
plotcp(full_tree)
summary(full_tree)

plot(full_tree, uniform=TRUE,
   main="Pruned Classification Tree for Kyphosis")
text(full_tree, use.n=TRUE, all=TRUE, cex=.5)

full_tree_pred <- predict(full_tree, newdata = tree_test, type = "class")

test_error <- sum(tree_test$Label != full_tree_pred) / length(full_tree_pred)
```


Two different shrinkage parameters, both perform worse 
```{r}
pruned_tree1<- prune(full_tree, cp = .05)
plot(pruned_tree1, uniform=TRUE,
   main="Pruned Classification Tree for Kyphosis")
text(pruned_tree1, use.n=TRUE, all=TRUE, cex=.5)

pruned_tree2<- prune(full_tree, cp = .1)
plot(pruned_tree2, uniform=TRUE,
   main="Pruned Classification Tree for Kyphosis")
text(pruned_tree2, use.n=TRUE, all=TRUE, cex=.5)


prune_tree1_pred <- predict(pruned_tree1, newdata = tree_test, type = "class")
prune_tree1_test_error <- sum(tree_test$Label != prune_tree1_pred) / length(prune_tree1_pred)

prune_tree2_pred <- predict(pruned_tree2, newdata = tree_test, type = "class")
prune_tree2_test_error <- sum(tree_test$Label != prune_tree2_pred) / length(prune_tree2_pred)
```
Random Forest
```{r}
rf <- randomForest(as.factor(Label) ~ .,data=tree_data, importance = T)

rf
importance(rf)
```